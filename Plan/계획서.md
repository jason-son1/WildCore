# 마인크래프트 1.21 소규모 야생 서버 개발 계획서

## 1. 개요 및 환경 설정

- **서버 버전:** Java Edition 1.21.1 (최신 안정화 버전 권장)
        
- **서버 코어:** **Paper** 또는 **Purpur** (1.21.1 지원, 성능 최적화 및 플러그인 호환성 우수)
    
- **Java 버전:** Java 21 (1.21 버전 필수 요구 사항)
    

## 2. 기존 개발용(무료) 플러그인 구성안

최대한 검증된 무료 플러그인을 사용하여 개발 공수를 줄이고 안정성을 확보합니다.

### A. 기반 시스템 (필수)

|                            |           |                                         |
| -------------------------- | --------- | --------------------------------------- |
| **플러그인 명**                 | **용도**    | **선정 이유**                               |
| **Vault**                  | 경제/권한 API | 모든 경제/상점 플러그인의 기반. 필수.                  |
| **EssentialsX**            | 기초 명령어/경제 | `/money`, `/spawn` 등 기초 기능 및 화폐 데이터 관리. |
| **PlaceHolderAPI (PAPI)**  | 변수 연동     | 자체 제작 플러그인의 변수(주식 가격 등)를 채팅/GUI에 표시.    |
| **LuckPerms**              | 권한 관리     | 유저/관리자 권한 분리.                           |
| **Citizens**               | NPC 생성    | 스폰 마을의 상점, 인챈트, 주식 NPC 구현.              |
| **CommandNPC**             | NPC 명령 연동 | NPC 클릭 시 자체 개발한 GUI나 명령어가 실행되도록 연결.     |
| **WorldGuard & WorldEdit** | 지역 보호     | 스폰 지역 파괴 방지 및 인챈트 테이블 사용 금지 구역 설정.      |

### B. 콘텐츠 구현용

|   |   |   |
|---|---|---|
|**플러그인 명**|**용도**|**선정 이유**|
|**MythicMobs** (Free)|레어 엔티티/드랍|커스텀 스킬을 쓰는 몬스터 생성 및 드랍 테이블 정밀 설정 가능.|
|**DeluxeMenus**|GUI 제작|상점, 인챈트, 주식 정보창 등의 UI 디자인을 YAML 설정만으로 가능하게 함.|
|**ExecutableItems** (Free)|특수 아이템|'인챈트 전용 아이템', '레어 드랍 아이템' 제작 용이.|

## 3. 기능별 구현 상세 가이드

### [1] 전용 인챈트 시스템

- **기획 의도:** 바닐라 인챈트 테이블 제거, NPC/GUI를 통한 확률형 강화 (돈 + 특수 아이템 소모).
    
- **구현 방법:**
    
    1. **바닐라 차단:** `WorldGuard`의 `use` 플래그로 인챈트 테이블 사용을 막거나, 자체 플러그인에서 `PrepareItemEnchantEvent`를 캔슬.
        
    2. **UI 구성:** `DeluxeMenus`로 인챈트 메뉴(GUI)를 디자인. (예: "강화하기" 버튼 배치)
        
    3. **로직 처리 (자체 플러그인 필요):**
        
        - 메뉴에서 버튼 클릭 시 자체 플러그인 명령어를 실행 (`/customenchant try <type>`).
            
        - 인벤토리에 '특수 아이템(ExecutableItems로 제작)'과 '돈(Vault)'이 있는지 검사.
            
        - 확률 계산 후 성공 시 `addEnchantment`, 실패 시 아이템 파괴 or 재료 소실 로직 수행.
            

### [2] 경제 및 주식 시스템

- **기획 의도:** 단순 랜덤 확률 기반의 가상 주식.
    
- **구현 방법:**
    
    1. **자체 플러그인 개발 (핵심):**
        
        - `StockTask`: 일정 시간(예: 30분)마다 실행되는 스케줄러.
            
        - 각 종목(예: '다이아몬드 광산 주', '좀비 고기 선물')의 가격을 난수(Random)에 의해 변동 (-5% ~ +5%).
            
        - 유저별 주식 보유량을 저장하는 데이터 파일(`stocks.yml` or DB) 관리.
            
    2. **연동:**
        
        - `PlaceholderAPI` 확장을 자체 플러그인 내에 구현하여 `%myserver_stock_A_price%` 처럼 가격을 GUI에 실시간 표기.
            
        - NPC 클릭 시 매수/매도 GUI 오픈.
            

### [3] 레어 엔티티 & 레어 드랍

- **기획 의도:** 자연 스폰 중 희귀 몬스터 등장, 특수 아이템 드랍.
    
- **구현 방법 (MythicMobs 활용):**
    
    1. `Mobs.yml`에 레어 몬스터 생성 (예: `SuperZombie` - 체력 100, 속도 빠름).
        
    2. `RandomSpawns.yml` 설정으로 야생(World)에서 좀비가 스폰될 때 5% 확률로 `SuperZombie`로 교체.
        
    3. `Drops.yml` 또는 `ExecutableItems`를 연동하여 처치 시 '인챈트 강화석' 등 드랍 설정.
        
    
    - _이 부분은 자체 개발 없이 플러그인 설정만으로 완벽 구현 가능._
        

### [4] 상점 시스템

- **기획 의도:** 희귀템 판매 및 필수품 구매.
    
- **구현 방법:**
    
    - **옵션 A (간편):** `EconomyShopGUI-Lite` (무료) 사용. 설정 파일에서 아이템 가격만 수정.
        
    - **옵션 B (커스텀):** `DeluxeMenus`를 사용하여 상점 UI를 직접 그림.
        
        - 구매 버튼에 `[console] give %player_name% diamond 1`, `[console] eco take %player_name% 1000` 명령어를 심는 방식.
            
        - 기획하신 내용이 "특정 아이템" 위주이므로 **DeluxeMenus**로 수동 구성하는 것이 더 깔끔함.
            

### [5] 기타 (유틸리티 아이템)

- **기획 의도:** 인벤 세이브권, 워프권 등.
    
- **구현 방법 (자체 플러그인 개발):**
    
    - **인벤토리 세이브권:**
        
        - 서버 기본 설정: `gamerule keepInventory false`.
            
        - `PlayerDeathEvent` 리스너 등록.
            
        - 사망 시 인벤토리에 '세이브권(특정 Lore나 NBT를 가진 종이)'이 있는지 검사.
            
        - 있으면: `event.setKeepInventory(true)`, `event.getDrops().clear()`, 세이브권 1개 제거, 메시지 출력.
            
        - 없으면: 일반 사망 처리.
            
    - **워프권/쿠폰:**
        
        - 아이템 우클릭 이벤트(`PlayerInteractEvent`) 감지.
            
        - '스폰 워프권' 우클릭 -> 아이템 제거 후 `/spawn` 명령어 실행(Op권한으로).
            

## 4. 자체 제작 플러그인 개발 명세 (CorePlugin)

위 기획 중 기존 플러그인으로 해결되지 않는 핵심 로직을 담을 플러그인 구조입니다.

### A. 프로젝트 구조

- **이름:** `WildCore` (가칭)
    
- **패키지:** `com.myserver.wildcore`
    
- **디펜던시:** Spigot/Paper API 1.21, Vault API, PlaceholderAPI, MythicMobs(선택)
    

### B. 주요 클래스 설계

#### 1. `StockManager.java` (주식)

- `HashMap<String, Double> stockPrices`: 종목별 현재가 저장.
    
- `updateStocks()`: 랜덤 등락 로직. (config.yml에서 변동폭 설정)
    
- `buyStock(Player p, String stockName, int amount)`: 돈 차감 후 유저 데이터(yml/db)에 주식 수량 증가.
    
- `sellStock(Player p, String stockName, int amount)`: 반대 로직.
    

#### 2. `EnchantManager.java` (인챈트)

- `tryEnchant(Player p, String enchantType)`:
    
    - 인벤토리 체크 (Vault로 돈 확인, 아이템 확인).
        
    - `Random`으로 성공/실패 판정.
        
    - 성공 시: `p.getInventory().getItemInMainHand().addEnchantment(...)`.
        
    - 실패 시: 아이템 삭제 또는 내구도 감소.
        

#### 3. `ItemListener.java` (소모품/세이브권)

- `@EventHandler onDeath(PlayerDeathEvent e)`:
    
    - 사망자 인벤토리 루프 -> '인벤토리 세이브권' Lore/CustomModelData 확인.
        
    - 발견 시 -> `e.setKeepInventory(true)`, `e.setDroppedExp(0)`, 아이템 1개 차감.
        
- `@EventHandler onInteract(PlayerInteractEvent e)`:
    
    - 워프권 우클릭 시 텔레포트 로직 수행.
        

## 5. 개발 및 세팅 순서

1. **서버 기초 구축:** Paper 1.21.1 구동 및 `EssentialsX`, `Vault`, `LuckPerms` 설치.
    
2. **월드 및 지역 설정:** `WorldGuard`로 스폰 지역 보호 설정, `gamerule keepInventory false` 설정.
    
3. **NPC 및 메뉴 디자인:**
    
    - `Citizens`로 NPC 배치.
        
    - `DeluxeMenus`로 상점, 주식, 인챈트 UI의 껍데기(디자인) 제작.
        
4. **자체 플러그인 개발:**
    
    - 주식 알고리즘 구현 및 PAPI 연동.
        
    - 인벤 세이브권 로직 구현.
        
    - 인챈트 확률 로직 구현.
        
5. **아이템 제작 및 연동:**
    
    - `ExecutableItems`로 화폐용 아이템, 강화 재료, 세이브권 아이템 생성.
        
    - 자체 플러그인에서 해당 아이템의 이름/Lore를 인식하도록 코드 매칭.
        
6. **MythicMobs 설정:** 레어 몹 스폰 및 드랍 테이블 구성.


# 🛠️ WildCore 플러그인 상세 설계 (Data-Driven Architecture)

이 설계의 핵심은 **"코드는 논리(Logic)만 담당하고, 내용(Content)은 설정 파일(Config)이 담당한다"**입니다. 개발자가 코드를 수정하지 않고도 서버 운영 중에 인챈트 확률, 가격, 주식 종목 등을 변경할 수 있습니다.

## 1. 파일 시스템 구조 (Configuration)

플러그인 폴더 내에 다음과 같이 설정 파일을 분리하여 관리합니다.

Plaintext

```
plugins/WildCore/
├── config.yml       # 전역 설정 (DB 연결, 기본 메시지 등)
├── stocks.yml       # 주식 종목, 변동폭, GUI 설정
├── enchants.yml     # 강화 종류, 확률, 비용, GUI 설정
└── messages.yml     # 채팅 메시지 커스텀 (언어 설정)
```

---

## 2. 모듈별 설정 데이터 구조 (YAML 예시)

### A. 주식 시스템 (`stocks.yml`)

주식 종목과 변동 로직을 정의합니다.

YAML

```
settings:
  update_interval: 1800 # 초 단위 (30분마다 갱신)
  gui_title: "&8[ &a서버 주식 시장 &8]"
  gui_size: 27

stocks:
  zombie_flesh:
    display_name: "&2좀비 고기 선물"
    item_material: "ROTTEN_FLESH" # GUI 아이콘
    slot: 10
    base_price: 500.0
    min_price: 100.0
    max_price: 2000.0
    volatility: 0.1 # 변동성 (10% 내외 등락)
  diamond_mine:
    display_name: "&b다이아몬드 광산주"
    item_material: "DIAMOND_ORE"
    slot: 12
    base_price: 5000.0
    min_price: 1000.0
    max_price: 50000.0
    volatility: 0.2
```

### B. 인챈트 시스템 (`enchants.yml`)

어떤 아이템을 재료로 쓰는지, 성공 확률은 얼마인지, 실패 패널티는 무엇인지 정의합니다.

YAML

```
settings:
  gui_title: "&8[ &5신비한 강화소 &8]"
  gui_size: 9

enchants:
  sharpness_1:
    display_name: "&c날카로움 I 부여"
    slot: 3
    target_item: "SWORD" # 검 종류만 가능 (SWORD, PICKAXE, ARMOR 등 카테고리화 필요)
    result_enchant: "SHARPNESS:1" # 바닐라 인챈트 이름:레벨
    
    # 비용 설정
    cost_money: 1000.0
    cost_items:
      - "DIAMOND:2" # 다이아몬드 2개 필요
      - "LAPIS_LAZULI:5"
    
    # 확률 로직 (0.0 ~ 100.0)
    success_rate: 80.0
    
    # 실패 시 패널티 (DESTROY: 파괴, DOWNGRADE: 강화수치 하락, NOTHING: 재료만 소모)
    fail_penalty: "NOTHING" 
    
  protection_god:
    display_name: "&6보호 IV 부여 (도박)"
    slot: 5
    target_item: "ARMOR"
    result_enchant: "PROTECTION:4"
    cost_money: 50000.0
    cost_items:
      - "NETHER_STAR:1"
    success_rate: 15.0
    fail_penalty: "DESTROY" # 실패 시 장비 파괴
```

---

## 3. Java 클래스 설계 (Core Logic)

위 설정 파일을 읽어 작동하는 자바 클래스 구조입니다.

### [1] 데이터 로드 및 관리 (Managers)

**`ConfigManager.java`**

- 플러그인 시작(`onEnable`) 시 YAML 파일을 파싱하여 메모리(`HashMap`)에 적재합니다.
    
- `/wildcore reload` 명령어 입력 시 파일을 다시 읽어옵니다.
    

**`StockManager.java`**

- `HashMap<String, StockData>`: 종목별 데이터를 저장.
    
- `startScheduler()`: `stocks.yml`의 `update_interval`을 읽어 스케줄러를 등록.
    
- `updatePrice()`: 각 주식 객체의 `volatility` 값을 기반으로 랜덤 가격 변동 계산.
    
    - _수식 예:_ $CurrentPrice = PreviousPrice \times (1 + Random(-Volatility, Volatility))$
        

**`EnchantManager.java`**

- `HashMap<String, EnchantOption>`: 설정된 인챈트 옵션들을 저장.
    
- `getOptionsFor(Material item)`: 플레이어가 들고 있는 아이템에 적용 가능한 인챈트 목록 반환.
    

### [2] 동적 GUI 구현 (Dynamic GUI)

DeluxeMenus를 쓰지 않고, 설정 파일에 따라 인벤토리 화면을 그리는 클래스입니다.

**`GuiBuilder.java` (유틸리티)**

- `createItem(Material mat, String name, List<String> lore)`: 아이템스택 생성 헬퍼.
    

**`StockGui.java` implements `InventoryHolder`**

- `open(Player p)`:
    
    1. `stocks.yml`의 `gui_size`, `gui_title`로 인벤토리 생성.
        
    2. `StockManager`에 있는 모든 주식을 반복문(Loop)으로 돌림.
        
    3. 각 주식의 `slot` 위치에 아이콘 배치.
        
    4. Lore(설명)에 실시간 가격(`%price%`)과 변동률(`%change%`)을 적용하여 setItem.
        

**`EnchantGui.java` implements `InventoryHolder`**

- `open(Player p)`:
    
    1. 플레이어의 손에 든 아이템을 감지.
        
    2. 해당 아이템이 강화 가능한지 `EnchantManager`를 통해 확인.
        
    3. 가능하다면 `enchants.yml`에 정의된 버튼들을 배치.
        
    4. Lore에 "필요 재료", "성공 확률", "실패 시 패널티"를 동적으로 표시.
        

### [3] 이벤트 리스너 (Interaction)

**`GuiListener.java`**

- `@EventHandler onInventoryClick(InventoryClickEvent e)`
    
    - 클릭한 인벤토리가 `StockGui`인지 `EnchantGui`인지 확인 (`instanceof` 체크).
        
    - 클릭한 슬롯이 설정된 버튼인지 확인.
        
    - **주식인 경우:** 매수/매도 로직 실행 (좌클릭 매수, 우클릭 매도 등).
        
    - **인챈트인 경우:**
        
        1. `Vault` API로 돈 확인.
            
        2. `Inventory` API로 재료 아이템 확인 및 차감.
            
        3. `Math.random() * 100`과 `success_rate` 비교.
            
        4. 결과에 따라 아이템 메타 데이터 수정(`addEnchant`) 혹은 파괴(`item.setAmount(0)`).
            
        5. 성공/실패 사운드 및 파티클 재생.
            

---

## 4. 개발 로드맵 수정

### 1단계: 뼈대 구축

- [x] `WildCore` 프로젝트 생성.
    
- [x] `config.yml`, `stocks.yml`, `enchants.yml` 파일 생성 및 로드 로직 구현.
    
- [x] 설정 파일 내용을 담을 DTO(Data Transfer Object) 클래스 생성 (`StockData`, `EnchantOption`).
    

### 2단계: 주식 시스템 구현

- [x] 주식 가격 변동 알고리즘 구현 (스케줄러).
    
- [x] 주식 GUI 렌더링 (설정 파일의 슬롯/아이콘 대로 뜨는지 확인).
    
- [x] 플레이어 데이터 저장소 연동 (유저가 산 주식 수량 저장).
    

### 3단계: 인챈트 시스템 구현

- [x] 바닐라 인챈트 테이블 클릭 이벤트 캔슬 및 커스텀 GUI 오픈 연결.
    
- [x] 인챈트 버튼 클릭 시 재료/돈 차감 로직.
    
- [x] 확률 계산 및 결과(성공/실패/파괴) 적용 로직.
    

### 4단계: 테스트 및 밸런싱

- [x] 서버 구동 중 `enchants.yml`의 확률을 수정하고 `/wildcore reload` 했을 때 바로 적용되는지 확인.
    
- [x] 극단적인 값(확률 0%, 100%, 가격 -1원 등) 입력 시 예외 처리 확인.
    

---

## 5. 기대 효과

1. **기획의 자유:** 개발자가 없어도 기획자나 운영진이 메모장으로 yml 파일만 열어서 "오늘은 이벤트를 위해 다이아 검 강화 확률을 90%로 올리자"와 같은 패치가 가능합니다.
    
2. **퍼포먼스 최적화:** DeluxeMenus와 같은 범용 플러그인은 기능이 방대한 만큼 무거울 수 있으나, 자체 제작 플러그인은 딱 필요한 기능만 수행하므로 훨씬 가볍습니다.
    
3. **일관성:** 주식과 인챈트 시스템이 하나의 플러그인에서 관리되므로, 주식으로 번 돈을 바로 인챈트에 쓰는 등의 경제 순환 구조를 더 단단하게 설계할 수 있습니다.
    

이 방향으로 진행하신다면 **Spigot Configuration API** 활용 능력이 개발의 핵심이 될 것입니다.